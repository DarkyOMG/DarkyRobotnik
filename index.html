<!doctype html>
<html>

<head>
   <title>DarkyRobotnik Alerts</title>
   <link rel="icon" href="/images/favicon.ico" sizes="any"><!-- 32Ã—32 -->
   <link rel="stylesheet" href="styles.css">
</head>

<body>
   <figure>
      <audio src="Follow.wav"></audio>
   </figure>
   <div class="animthing">
      <figure>
         <img src="images/Follow.gif" alt="Couldn't find image">
         <p>FOLLOW!</p>
      </figure>
   </div>
</body>
<script type="text/javascript">
   const audioelem = document.querySelector("audio");
   const imageelem = document.querySelector("div");
   let audioelemlist = []
   WebSocketTest();
   function WebSocketTest() {
      if ("WebSocket" in window) {

         // Let us open a web socket
         var ws = new WebSocket("wss://muskatnuss.duckdns.org");

         ws.onopen = function () {
            console.log("Connected to server!")
            alert("Connection is open!")
         };

         ws.onmessage = function (evt) {
            var received_msg = evt.data;
            if (received_msg == 'follow') {
               imageelem.src = 'images/Follow.gif';
               audioelem.src = 'clips/Follow.wav';
               audioelem.play();
               imageelem.classList.remove("animthing");
               setTimeout(function () {
                  imageelem.classList.add("animthing");
               }, 0);
            }
            if (received_msg == 'raid') {
               imageelem.src = 'images/Raid.png';
               audioelem.src = 'clips/Raid.wav';
               audioelem.play();
               imageelem.classList.remove("animthing");
               setTimeout(function () {
                  imageelem.classList.add("animthing");
               }, 0);
            }
            let tones = ["A","H","C","D","E","F","G"]
            if (received_msg.slice(0, 4) == 'clip') {
               if (received_msg.slice(4) == "Clap" || tones.includes(received_msg.slice(4))) {
                  var tempaudio = document.createElement("audio");
                  tempaudio.src = 'clips/' + received_msg.slice(4) + '.wav';
                  tempaudio.play();
                  setTimeout(function () {
                     tempaudio.remove();
                  }, 2000);
               }
               else {
                  audioelem.src = 'clips/' + received_msg.slice(4) + '.wav';
                  audioelem.play();
               }
            }
         };


         ws.onclose = function () {

            // websocket is closed.
            alert("Connection is closed!");
         };
      } else {

         // The browser doesn't support WebSocket
         alert("WebSocket NOT supported by your Browser!");
      }
   }
</script>

</html>